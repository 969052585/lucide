<title>Lucide 图标</title>
<script src="index.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/webui-popover/1.2.18/jquery.webui-popover.min.css"
    integrity="sha512-n48mMpd2Ez+soTQuZManEgeJeSeBNynyPL7S23uY5zKXZiEpKn529rl4Zu01ZiJEyJPBYMPp5AxNQD3XRh1oeg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/webui-popover/1.2.18/jquery.webui-popover.min.js"
    integrity="sha512-c7jfqR4Yc1iFS3KA+EceHmO91hjSfqNZ6cu00AKBE62BmQq7EOoCVGGwjV/OoaEG1teTU9nY6gBuToAzFfxMSw=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<style>
    #actions {
        position: sticky;
        top: 5px;
        z-index: 1;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    #actions * {
        margin-left: 4px;
        font-size: 20px;
    }

    .settings {
        margin-right: 2px;
    }

    

    .settings>.setting {
        display: none;
        z-index: 2;
        background: white;
        position: absolute;
        top: calc(100% + 10px);
        left: -8px;
        padding: 8px;
        border-radius: 5px;
        box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1), -2px -2px 4px rgba(0, 0, 0, 0.1);
    }

    .settings:hover>.setting, .settings.in>.setting {
        display: unset;
    }

    .settings>.setting {
        max-width: 300px;
    }

    body {
        font-family: Arial, sans-serif;
    }

    .category {
        margin-top: 10px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        padding: 10px;
    }

    .category>header {
        display: flex;
        align-items: center;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .category>header img {
        height: 100%;
        margin-right: 10px;
    }

    .category>main {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
    }

    .category>main img {
        height: 40px;
    }

    .category>main>.icon {
        min-width: 56px;
        min-height: 56px;
        display: flex;
        justify-content: center;
        position: relative;
        align-items: center;
        background: #f6f6f7;
        padding: 15px;
    }

    .category>main>.icon>div {
        margin-left: 2px;
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }


    #popup {
        display: none;
        position: fixed;
        top: 2rem;
        right: 2rem;
        background: white;
        padding: 20px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        z-index: 1000;
    }

    .webui-popover .webui-popover-content>div:first-child {
        width: unset;
    }

    .webui-popover .webui-popover-content>div {
        text-align: center;
    }
</style>
<style>
    :root {
        --customize-color: black;
        --customize-strokeWidth: 2px;
        --customize-size: 24px;
    }

    .icon>svg {
        will-change: width, height, stroke-width, stroke;
        color: var(--customize-color);
        width: var(--customize-size);
        height: var(--customize-size);
        stroke-width: calc(var(--customize-strokeWidth, 2) * 1px);
    }

    html.absolute-stroke-width .icon>svg {
        stroke-width: calc(var(--customize-strokeWidth, 2) * 24 / var(--customize-size, 24) * 1px);
    }

    .setting {
        margin-bottom: 15px;
        width: 300px;
    }
</style>
<meta charset="utf8">
<div id="popup">
    <p>复制成功</p>
</div>
<div id="actions">
    <span class="settings" style="position: relative;">
        <svg title="样式设置" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5551"
            width="24" height="24">
            <path
                d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0S464 796.8 368 736c-22.4-12.8-41.6-19.2-57.6-19.2-51.2 0-83.2 44.8-86.4 83.2z m336-124.8l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32 3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2h22.4c12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2z m-336-256c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2-28.8 0-51.2-22.4-51.2-51.2z m96-134.4c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6-22.4 0-41.6-19.2-41.6-41.6zM457.6 208c0-12.8 12.8-25.6 25.6-25.6s25.6 12.8 25.6 25.6-12.8 25.6-25.6 25.6-25.6-12.8-25.6-25.6zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32-211.2-3.2-380.8 169.6-380.8 384zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6l9.6-19.2C569.6 560 790.4 140.8 803.2 112c6.4-19.2-3.2-32-19.2-32-6.4-3.2-12.8 0-19.2 6.4z"
                p-id="5552" fill="#2c2c2c"></path>
        </svg>
        <div class="setting">
            <div>
                <label for="color">颜色</label>
                <input type="color" id="color">
            </div>
            <div>
                <label for="stroke-width">描边宽度</label>
                <input type="range" id="stroke-width" name="stroke-width" min="0.5" max="3" step="0.1" value="2">
                <span id="stroke-width-value">2px</span>
            </div>
            <div>
                <label for="size">大小</label>
                <input type="range" id="size" name="size" min="16" max="48" value="24">
                <span id="size-value">24px</span>
            </div>
            <div>
                <label for="absolute-stroke">固定描边宽度</label>
                <input type="checkbox" id="absolute-stroke">
            </div>
        </div>
    </span>
    <div>
        驼峰 <input name="type" type="radio" checked="checked" value="驼峰">
        烤肉串 <input name="type" type="radio" value="下划线">
        SVG <input name="type" type="radio" value="SVG">
        <select style="padding: 4px" id="category-filter">
            <option value="">全部</option>
        </select>
        <input id="search" style="padding: 3px" type="search" placeholder="图标名称" />
    </div>
</div>
<div id="categories"></div>
<script>
    const categoryIcons = {}
    Object.entries(iconDetail).forEach(([icon, {
        categories,
        tags
    }]) => {
        (categories || []).forEach(category => {
            if (categoryIcons[category]) categoryIcons[category].push(icon)
            else categoryIcons[category] = [icon]
        })
    })

    const categoriesDiv = document.getElementById('categories');
    Object.entries(categories).map(async ([category, zhName]) => {
        const {
            icon,
            title
        } = categoryDetail[category]
        // const {categories, tags} = iconDetail[category]
        let parse = new DOMParser().parseFromString(`<div class="category"  data-category="${category}">
         <header>
             <img loading="lazy" src="/icons/${icon}.svg" alt="${zhName}">
             <span title="${zhName}">${zhName} ${title} (${categoryIcons[category]?.length})</span>
         </header>
         <main>

         </main>
     </div>`, "text/html");

        async function addIconDiv(icon) {
            let iconParse = new DOMParser().parseFromString(`<div data-name="${icons[icon]}" data-src="/icons/${icon}.svg" data-icon="${icon}" class="icon">
                 <div>
                        <div>${icons[icon]}</div>
                        <div>${icon}</div>
                  </div>
     </div>`, "text/html");
            parse.body.children[0].children[1].appendChild(iconParse.body.children[0])
        }

        (categoryIcons[category] || []).map(addIconDiv)

        categoriesDiv.appendChild(parse.body.children[0])
    })


    const categoryFilter = document.getElementById('category-filter');
    Object.entries(categories).forEach(([category, zhName]) => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = zhName;
        categoryFilter.appendChild(option);
    });


    $("#category-filter").change(function () {
        const selectedCategory = $(this).val();
        if (selectedCategory === "") {
            $(".category").show();
        } else {
            $(".category").each(function () {
                if ($(this).data("category") === selectedCategory) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
        }
    });

    $(document).ready(function () {
        $("#search").change(function () {
            let search = $(this).val().trim().toLowerCase()
            if (!search) {
                $(".icon").children("div").css('display', "none")
                $(".icon").show()
                return
            }
            $(".icon").each(function () {
                let icon = $(this).attr("data-icon").toLowerCase()
                let name = $(this).attr("data-name").toLowerCase()
                if (name.includes(search) || icon.includes(search)) {
                    $(this).show()
                    $(this).children("div").css('display', "flex")
                } else {
                    $(this).hide()
                    $(this).children("div").css('display', "none")
                }
            })
        })

        $(".icon").click(function () {
            let icon = $(this).attr("data-icon")
            let name = $(this).attr("data-name")
            let copyValue;
            if ($('input[name="type"]:checked').val() === '驼峰') {
                copyValue = icon
                    .split('-')
                    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                    .join('')
            } else if ($('input[name="type"]:checked').val() === '下划线') {
                copyValue = icon
            } else if ($('input[name="type"]:checked').val() === 'SVG') {
                $.ajax({
                    url: `/icons/${icon}.svg`,
                    type: 'GET',
                    dataType: 'text',
                    success: function (svgContent) {
                        navigator.clipboard.writeText(svgContent).then(function () {
                            $("#popup").text("【" + name + "】SVG复制成功");
                            $("#popup").show();
                            setTimeout(() => $("#popup").hide(), 1000)
                        }).catch(function (error) {
                            $("#popup").text("复制失败");
                            $("#popup").show();
                            setTimeout(() => $("#popup").hide(), 1000)
                        });
                    },
                    error: function () {
                        $("#popup").text("读取 SVG 文件失败");
                        $("#popup").show();
                        setTimeout(() => $("#popup").hide(), 1000)
                    }
                });
                return;
            }
            navigator.clipboard.writeText(copyValue).then(function () {
                $("#popup").text(name + "【" + copyValue + "】 复制成功");
                $("#popup").show();
                setTimeout(() => $("#popup").hide(), 1000)
            }).catch(function (error) {
                $("#popup").text("复制失败");
                $("#popup").show();
                setTimeout(() => $("#popup").hide(), 1000)
            });
        })


        $('.icon').webuiPopover({
            content: function () {
                let icon = $(this).attr("data-icon")
                let name = $(this).attr("data-name")
                return `<div>${name}</div><div>${icon}</div>`
            },
            trigger: "hover"
        })
        $(".settings > svg").click(function () {
            $(this).parent().toggleClass("in")
        })
        $('.icon').each(function () {
            setTimeout(() => {
                let src = this.dataset.src;
                if (!src) return
                const xhr = new XMLHttpRequest();
                xhr.open('GET', src, true);
                let that = this
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        const svg = new DOMParser().parseFromString(xhr.responseText, 'image/svg+xml').documentElement;
                        that.prepend(svg);
                    }
                };
                xhr.send()
            }, 50)
        })
    });
</script>

<script>
    const colorInput = document.getElementById('color');
    const strokeWidthInput = document.getElementById('stroke-width');
    const strokeWidthValue = document.getElementById('stroke-width-value');
    const sizeInput = document.getElementById('size');
    const sizeValue = document.getElementById('size-value');
    const absoluteStrokeInput = document.getElementById('absolute-stroke');
    const root = document.documentElement;

    colorInput.addEventListener('change', function () {
        root.style.setProperty('--customize-color', this.value);
    });

    strokeWidthInput.addEventListener('input', function () {
        strokeWidthValue.innerHTML = this.value + 'px';
        root.style.setProperty('--customize-strokeWidth', this.value);
    });

    sizeInput.addEventListener('input', function () {
        sizeValue.innerHTML = this.value + 'px';
        root.style.setProperty('--customize-size', this.value);
    });

    absoluteStrokeInput.addEventListener('change', function () {
        if (this.checked) {
            root.classList.add('absolute-stroke-width');
        } else {
            root.classList.remove('absolute-stroke-width');
        }
    });
</script>